{% extends 'base_luxury.html' %}

{% block title %}Add New Staff - AuraStay{% endblock %}
{% block page_title %}Add New Staff Member{% endblock %}
{% block page_subtitle %}Create a new team member account{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-3xl p-8 luxury-shadow">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Personal Information -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-luxury-800 mb-4">Personal Information</h3>
                    
                    <div>
                        <label for="first_name" class="block text-sm font-medium text-luxury-700 mb-2">First Name</label>
                        <input type="text" name="first_name" id="first_name" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                    
                    <div>
                        <label for="last_name" class="block text-sm font-medium text-luxury-700 mb-2">Last Name</label>
                        <input type="text" name="last_name" id="last_name" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                    
                    <div>
                        <label for="username" class="block text-sm font-medium text-luxury-700 mb-2">Username</label>
                        <input type="text" name="username" id="username" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-medium text-luxury-700 mb-2">Email</label>
                        <input type="email" name="email" id="email" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                </div>
                
                <!-- Work Information -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-luxury-800 mb-4">Work Information</h3>
                    
                    <div>
                        <label for="assigned_hotel" class="block text-sm font-medium text-luxury-700 mb-2">Assigned Hotel</label>
                        <select name="assigned_hotel" id="assigned_hotel" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Hotel</option>
                            {% for hotel in available_hotels %}
                                <option value="{{ hotel.hotel_id }}">{{ hotel.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label for="role" class="block text-sm font-medium text-luxury-700 mb-2">Role</label>
                        <select name="role" id="role" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Role</option>
                            {% for role in available_roles %}
                                <option value="{{ role }}">{{ role }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-luxury-700 mb-2">Phone (Optional)</label>
                        <input type="tel" name="phone" id="phone" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-luxury-700 mb-2">Password</label>
                        <input type="password" name="password" id="password" 
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               value="password123" required>
                        <p class="text-xs text-luxury-500 mt-1">Staff can change this password after first login</p>
                    </div>
                </div>
                
                <!-- Permissions -->
                <div class="space-y-6">
                    <h3 class="text-lg font-semibold text-luxury-800 mb-4">Role Permissions</h3>
                    
                    <div id="rolePermissions" class="bg-luxury-50 border border-luxury-200 rounded-xl p-6">
                        <div class="text-center text-luxury-500 py-8">
                            <i class="fas fa-shield-alt text-4xl mb-4 text-luxury-300"></i>
                            <p>Select a role to see available permissions</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-4 pt-6">
                <button type="submit" 
                        class="bg-royal-500 text-white px-8 py-3 rounded-xl font-semibold hover:bg-royal-600 transition-colors flex items-center space-x-2">
                    <i class="fas fa-user-plus"></i>
                    <span>Add Staff Member</span>
                </button>
                <a href="{% url 'staff:list' %}" 
                   class="bg-luxury-200 text-luxury-700 px-8 py-3 rounded-xl font-semibold hover:bg-luxury-300 transition-colors">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Role permissions mapping based on backend definitions
const rolePermissions = {
    'Manager': [
        'View Properties',
        'Change Property Settings',
        'View Staff',
        'Add Staff',
        'Change Staff',
        'View Reservations',
        'Add Reservation',
        'Change Reservation',
        'View Guests',
        'Add Guest',
        'Change Guest',
        'View Housekeeping',
        'Manage Housekeeping',
        'View Maintenance',
        'Manage Maintenance',
        'View Billing',
        'View Reports'
    ],
    'Staff': [
        'View Reservations',
        'Add Reservation',
        'Change Reservation',
        'View Guests',
        'Add Guest',
        'Change Guest',
        'View Rooms',
        'Change Room Status'
    ],
    'Receptionist': [
        'View Reservations',
        'Add Reservation',
        'Change Reservation',
        'View Guests',
        'Add Guest',
        'Change Guest',
        'Check-in Guest',
        'Check-out Guest',
        'View Billing',
        'Process Payment',
        'View Rooms',
        'Change Room Status'
    ],
    'Housekeeper': [
        'View Housekeeping Tasks',
        'Change Housekeeping Task',
        'View Rooms',
        'Change Room Status',
        'Add Maintenance Issue'
    ],
    'Maintenance': [
        'View Maintenance Issues',
        'Change Maintenance Issue',
        'View Rooms',
        'View Inventory',
        'Change Inventory'
    ],
    'Kitchen': [
        'View POS Orders',
        'Change POS Order',
        'View POS Items',
        'Add POS Order',
        'View Inventory',
        'Change Inventory'
    ],
    'Accountant': [
        'View Billing',
        'Manage Billing',
        'View Payments',
        'Manage Payments',
        'View Reports',
        'Generate Reports'
    ]
};

// Handle role selection change
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('role');
    const permissionsContainer = document.getElementById('rolePermissions');
    
    if (roleSelect && permissionsContainer) {
        roleSelect.addEventListener('change', function() {
            const selectedRole = this.value;
            
            if (!selectedRole || !rolePermissions[selectedRole]) {
                permissionsContainer.innerHTML = `
                    <div class="text-center text-luxury-500 py-8">
                        <i class="fas fa-shield-alt text-4xl mb-4 text-luxury-300"></i>
                        <p>Select a role to see available permissions</p>
                    </div>
                `;
                return;
            }
            
            const permissions = rolePermissions[selectedRole];
            let permissionsHtml = `
                <div class="mb-4">
                    <h4 class="font-semibold text-luxury-800 mb-2 flex items-center">
                        <i class="fas fa-user-shield mr-2 text-royal-500"></i>
                        ${selectedRole} Permissions
                    </h4>
                    <p class="text-sm text-luxury-600 mb-4">This role will automatically have the following permissions:</p>
                </div>
                <div class="grid grid-cols-1 gap-2">
            `;
            
            permissions.forEach(permission => {
                permissionsHtml += `
                    <div class="flex items-center p-2 bg-white border border-luxury-200 rounded-lg">
                        <i class="fas fa-check-circle text-green-500 mr-3 text-sm"></i>
                        <span class="text-sm font-medium text-luxury-700">${permission}</span>
                    </div>
                `;
            });
            
            permissionsHtml += '</div>';
            permissionsContainer.innerHTML = permissionsHtml;
        });
    }
});
</script>

<style>
    .luxury-shadow {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .luxury-50 {
        background-color: #f8fafc;
    }
</style>
{% endblock %}