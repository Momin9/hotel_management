{% extends 'base_luxury.html' %}

{% block title %}Maintenance Dashboard - AuraStay{% endblock %}
{% block page_title %}Maintenance Dashboard{% endblock %}
{% block page_subtitle %}Monitor and manage all maintenance activities{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-3xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Total Issues</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ total_issues }}</p>
                    <p class="text-xs text-luxury-500 mt-1">All time</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-clipboard-list text-blue-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Open Issues</p>
                    <p class="text-3xl font-bold text-red-600">{{ open_issues }}</p>
                    <p class="text-xs text-luxury-500 mt-1">Needs attention</p>
                </div>
                <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-exclamation-circle text-red-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">In Progress</p>
                    <p class="text-3xl font-bold text-yellow-600">{{ in_progress_issues }}</p>
                    <p class="text-xs text-luxury-500 mt-1">Being worked on</p>
                </div>
                <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-tools text-yellow-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Urgent Issues</p>
                    <p class="text-3xl font-bold text-orange-600">{{ urgent_issues }}</p>
                    <p class="text-xs text-luxury-500 mt-1">High priority</p>
                </div>
                <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-fire text-orange-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Today's Work Orders -->
    <div class="bg-white rounded-3xl p-8 luxury-shadow">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-luxury-900">Today's Work Orders</h2>
            <a href="{% url 'maintenance:issue_create' %}" class="bg-royal-500 text-white px-6 py-2 rounded-xl hover:bg-royal-600 transition-colors flex items-center space-x-2">
                <i class="fas fa-plus"></i>
                <span>New Issue</span>
            </a>
        </div>
        
        {% if recent_issues %}
        <div class="space-y-4">
            {% for issue in recent_issues %}
            <div class="border border-luxury-200 rounded-2xl p-6 hover:bg-luxury-25 transition-colors">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <h3 class="font-semibold text-luxury-900">{{ issue.title }}</h3>
                            <span class="px-3 py-1 rounded-full text-sm font-medium
                                {% if issue.priority == 'urgent' %}bg-red-100 text-red-800
                                {% elif issue.priority == 'high' %}bg-orange-100 text-orange-800
                                {% elif issue.priority == 'medium' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-green-100 text-green-800{% endif %}">
                                {{ issue.get_priority_display }}
                            </span>
                            <span class="px-3 py-1 rounded-full text-sm font-medium
                                {% if issue.status == 'open' %}bg-blue-100 text-blue-800
                                {% elif issue.status == 'in_progress' %}bg-yellow-100 text-yellow-800
                                {% elif issue.status == 'resolved' %}bg-green-100 text-green-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ issue.get_status_display }}
                            </span>
                        </div>
                        <p class="text-luxury-600 mb-3">{{ issue.description|truncatechars:100 }}</p>
                        <div class="flex items-center space-x-6 text-sm text-luxury-500">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-building"></i>
                                <span>{{ issue.property.name }}</span>
                            </div>
                            {% if issue.room %}
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-door-open"></i>
                                <span>Room {{ issue.room.room_number }}</span>
                            </div>
                            {% endif %}
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-clock"></i>
                                <span>{{ issue.reported_at|timesince }} ago</span>
                            </div>
                            {% if issue.assigned_to %}
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-user"></i>
                                <span>{{ issue.assigned_to.user.get_full_name|default:issue.assigned_to.user.email }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 ml-4">
                        <a href="{% url 'maintenance:issue_update' issue.id %}" class="bg-royal-100 text-royal-600 p-2 rounded-lg hover:bg-royal-200 transition-colors" title="Update">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12">
            <div class="w-16 h-16 bg-luxury-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-clipboard-check text-luxury-400 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-luxury-900 mb-2">No Work Orders Today</h3>
            <p class="text-luxury-600 mb-4">All caught up! No maintenance issues reported today.</p>
        </div>
        {% endif %}
        
        <div class="mt-6 pt-6 border-t border-luxury-200">
            <a href="{% url 'maintenance:issue_list' %}" class="text-royal-600 hover:text-royal-700 font-medium flex items-center space-x-2">
                <span>View All Issues</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>

    <!-- Equipment Status -->
    <div class="bg-white rounded-3xl p-8 luxury-shadow">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-luxury-900">Equipment Status</h2>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Issues by Category -->
            <div class="bg-luxury-50 rounded-2xl p-6">
                <h3 class="font-semibold text-luxury-800 mb-4">Issues by Category</h3>
                {% if category_stats %}
                <div class="space-y-3">
                    {% for stat in category_stats %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                                <i class="fas fa-{% if stat.category == 'plumbing' %}tint{% elif stat.category == 'electrical' %}bolt{% elif stat.category == 'hvac' %}wind{% elif stat.category == 'furniture' %}couch{% elif stat.category == 'appliance' %}tv{% else %}wrench{% endif %} text-luxury-600"></i>
                            </div>
                            <span class="text-luxury-700 capitalize">{{ stat.category }}</span>
                        </div>
                        <span class="font-semibold text-luxury-900">{{ stat.count }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-luxury-500 text-center py-4">No issues by category</p>
                {% endif %}
            </div>
            
            <!-- Issues by Priority -->
            <div class="bg-luxury-50 rounded-2xl p-6">
                <h3 class="font-semibold text-luxury-800 mb-4">Priority Breakdown</h3>
                {% if priority_stats %}
                <div class="space-y-3">
                    {% for stat in priority_stats %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 rounded-full {% if stat.priority == 'urgent' %}bg-red-500{% elif stat.priority == 'high' %}bg-orange-500{% elif stat.priority == 'medium' %}bg-yellow-500{% else %}bg-green-500{% endif %}"></div>
                            <span class="text-luxury-700 capitalize">{{ stat.priority }}</span>
                        </div>
                        <span class="font-semibold text-luxury-900">{{ stat.count }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-luxury-500 text-center py-4">No priority data</p>
                {% endif %}
            </div>
            
            <!-- Recent Activity -->
            <div class="bg-luxury-50 rounded-2xl p-6">
                <h3 class="font-semibold text-luxury-800 mb-4">Recent Activity</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-luxury-600">Resolved Today</span>
                        <span class="font-semibold text-green-600">{{ resolved_issues }}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-luxury-600">New This Week</span>
                        <span class="font-semibold text-blue-600">{{ recent_issues|length }}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-luxury-600">Avg Resolution Time</span>
                        <span class="font-semibold text-luxury-900">2.5 days</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.luxury-shadow {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

.hover-lift {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 32px 64px -12px rgba(0, 0, 0, 0.35);
}

.luxury-25 {
    background-color: rgba(248, 250, 252, 0.5);
}
</style>
{% endblock %}