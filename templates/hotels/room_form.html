{% extends 'base_luxury.html' %}

{% block title %}{% if room %}Edit Room {{ room.room_number }}{% else %}Add New Room{% endif %} - {{ hotel.name }}{% endblock %}
{% block page_title %}{% if room %}Edit Room{% else %}Add New Room{% endif %}{% endblock %}
{% block page_subtitle %}{{ hotel.name }} - Room Management{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-3xl p-8 luxury-shadow">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Basic Information -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-luxury-800 mb-4">Basic Information</h3>
                    
                    <div>
                        <label for="room_number" class="block text-sm font-medium text-luxury-700 mb-2">Room Number</label>
                        <input type="text" name="room_number" id="room_number" 
                               value="{% if room %}{{ room.room_number }}{% endif %}"
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                    
                    <div>
                        <label for="type" class="block text-sm font-medium text-luxury-700 mb-2">Room Type</label>
                        <select name="type" id="type" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Type</option>
                            <option value="Single" {% if room and room.type == 'Single' %}selected{% endif %}>Single</option>
                            <option value="Double" {% if room and room.type == 'Double' %}selected{% endif %}>Double</option>
                            <option value="Twin" {% if room and room.type == 'Twin' %}selected{% endif %}>Twin</option>
                            <option value="Triple" {% if room and room.type == 'Triple' %}selected{% endif %}>Triple</option>
                            <option value="Quad" {% if room and room.type == 'Quad' %}selected{% endif %}>Quad</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="category" class="block text-sm font-medium text-luxury-700 mb-2">Category</label>
                        <select name="category" id="category" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Category</option>
                            <option value="Standard" {% if room and room.category == 'Standard' %}selected{% endif %}>Standard</option>
                            <option value="Deluxe" {% if room and room.category == 'Deluxe' %}selected{% endif %}>Deluxe</option>
                            <option value="SuperDeluxe" {% if room and room.category == 'SuperDeluxe' %}selected{% endif %}>Super Deluxe</option>
                            <option value="Executive" {% if room and room.category == 'Executive' %}selected{% endif %}>Executive</option>
                            <option value="Suite" {% if room and room.category == 'Suite' %}selected{% endif %}>Suite</option>
                            <option value="JuniorSuite" {% if room and room.category == 'JuniorSuite' %}selected{% endif %}>Junior Suite</option>
                            <option value="PresidentialSuite" {% if room and room.category == 'PresidentialSuite' %}selected{% endif %}>Presidential Suite</option>
                        </select>
                    </div>
                </div>
                
                <!-- Details -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-luxury-800 mb-4">Room Details</h3>
                    
                    <div>
                        <label for="bed" class="block text-sm font-medium text-luxury-700 mb-2">Bed Type</label>
                        <select name="bed" id="bed" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Bed Type</option>
                            <option value="King" {% if room and room.bed == 'King' %}selected{% endif %}>King</option>
                            <option value="Queen" {% if room and room.bed == 'Queen' %}selected{% endif %}>Queen</option>
                            <option value="DoubleBed" {% if room and room.bed == 'DoubleBed' %}selected{% endif %}>Double Bed</option>
                            <option value="TwinBed" {% if room and room.bed == 'TwinBed' %}selected{% endif %}>Twin Bed</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="price" class="block text-sm font-medium text-luxury-700 mb-2">Price per Night ($)</label>
                        <input type="number" name="price" id="price" step="0.01" min="0"
                               value="{% if room %}{{ room.price }}{% endif %}"
                               class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                               required>
                    </div>
                    
                    <div>
                        <label for="status" class="block text-sm font-medium text-luxury-700 mb-2">Status</label>
                        <select name="status" id="status" 
                                class="w-full px-4 py-3 border border-luxury-200 rounded-xl focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                                required>
                            <option value="">Select Status</option>
                            <option value="Available" {% if room and room.status == 'Available' %}selected{% endif %}>Available</option>
                            <option value="Occupied" {% if room and room.status == 'Occupied' %}selected{% endif %}>Occupied</option>
                            <option value="Reserved" {% if room and room.status == 'Reserved' %}selected{% endif %}>Reserved</option>
                            <option value="Dirty" {% if room and room.status == 'Dirty' %}selected{% endif %}>Dirty</option>
                            <option value="Cleaning" {% if room and room.status == 'Cleaning' %}selected{% endif %}>Cleaning</option>
                            <option value="Maintenance" {% if room and room.status == 'Maintenance' %}selected{% endif %}>Maintenance</option>
                            <option value="Blocked" {% if room and room.status == 'Blocked' %}selected{% endif %}>Blocked</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Amenities Section -->
            {% if amenities %}
            <div class="mt-8">
                <h3 class="text-lg font-semibold text-luxury-800 mb-4">Room Amenities</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Available Amenities -->
                    <div>
                        <h4 class="text-md font-medium text-luxury-700 mb-3">Available Amenities</h4>
                        <div class="space-y-2 max-h-64 overflow-y-auto border border-luxury-200 rounded-xl p-4">
                            {% for amenity in amenities %}
                            <div class="flex items-center space-x-3 p-2 hover:bg-luxury-50 rounded-lg transition-colors cursor-pointer" 
                                 onclick="addAmenity('{{ amenity.pk }}', '{{ amenity.name }}', '{{ amenity.icon|default:'fas fa-star' }}')">
                                <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="{{ amenity.icon|default:'fas fa-star' }} text-orange-600 text-sm"></i>
                                </div>
                                <span class="font-medium text-luxury-800">{{ amenity.name }}</span>
                                {% if amenity.description %}
                                <span class="text-sm text-luxury-600 ml-auto">{{ amenity.description|truncatechars:30 }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Selected Amenities -->
                    <div>
                        <h4 class="text-md font-medium text-luxury-700 mb-3">Selected Amenities</h4>
                        <div id="selectedAmenities" class="space-y-2 min-h-64 border border-luxury-200 rounded-xl p-4 bg-luxury-25">
                            {% if room %}
                                {% for amenity in room.amenities.all %}
                                <div class="selected-amenity flex items-center justify-between p-2 bg-white rounded-lg border border-luxury-200" data-amenity-id="{{ amenity.pk }}">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                            <i class="{{ amenity.icon|default:'fas fa-star' }} text-orange-600 text-sm"></i>
                                        </div>
                                        <span class="font-medium text-luxury-800">{{ amenity.name }}</span>
                                    </div>
                                    <button type="button" onclick="removeAmenity('{{ amenity.pk }}')" 
                                            class="w-6 h-6 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors">
                                        <i class="fas fa-times text-red-600 text-xs"></i>
                                    </button>
                                    <input type="hidden" name="amenities" value="{{ amenity.pk }}">
                                </div>
                                {% endfor %}
                            {% endif %}
                            <div id="emptyAmenitiesMessage" class="text-center text-luxury-500 py-8 {% if room.amenities.all %}hidden{% endif %}">
                                <i class="fas fa-star text-luxury-300 text-2xl mb-2"></i>
                                <p>No amenities selected</p>
                                <p class="text-sm">Click on amenities from the left to add them</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Services Section -->
            {% if services %}
            <div class="mt-8">
                <h3 class="text-lg font-semibold text-luxury-800 mb-4">Room Services</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for service in services %}
                    <div class="flex items-center space-x-3 p-3 border border-luxury-200 rounded-xl hover:bg-luxury-50 transition-colors">
                        <input type="checkbox" name="services" value="{{ service.service_id }}" id="service_{{ service.service_id }}"
                               {% if room and service in room.services.all %}checked{% endif %}
                               class="rounded border-luxury-300 text-royal-600 focus:ring-royal-500">
                        <label for="service_{{ service.service_id }}" class="flex-1 cursor-pointer">
                            <div class="font-medium text-luxury-800">{{ service.name }}</div>
                            {% if service.description %}
                            <div class="text-sm text-luxury-600">{{ service.description }}</div>
                            {% endif %}
                            <div class="text-sm font-semibold text-royal-600">{{ hotel.currency }} {{ service.price }}</div>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Action Buttons -->
            <div class="flex space-x-4 pt-6">
                <button type="submit" 
                        class="bg-royal-500 text-white px-8 py-3 rounded-xl font-semibold hover:bg-royal-600 transition-colors flex items-center space-x-2">
                    <i class="fas fa-save"></i>
                    <span>{% if room %}Update Room{% else %}Create Room{% endif %}</span>
                </button>
                <a href="{% url 'hotels:room_list' hotel.hotel_id %}" 
                   class="bg-luxury-200 text-luxury-700 px-8 py-3 rounded-xl font-semibold hover:bg-luxury-300 transition-colors">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function addAmenity(amenityId, amenityName, amenityIcon) {
    // Check if already selected
    if (document.querySelector(`[data-amenity-id="${amenityId}"]`)) {
        return;
    }
    
    const selectedContainer = document.getElementById('selectedAmenities');
    const emptyMessage = document.getElementById('emptyAmenitiesMessage');
    
    // Hide empty message
    emptyMessage.classList.add('hidden');
    
    // Create selected amenity element
    const amenityDiv = document.createElement('div');
    amenityDiv.className = 'selected-amenity flex items-center justify-between p-2 bg-white rounded-lg border border-luxury-200 animate-fadeIn';
    amenityDiv.setAttribute('data-amenity-id', amenityId);
    
    amenityDiv.innerHTML = `
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                <i class="${amenityIcon} text-orange-600 text-sm"></i>
            </div>
            <span class="font-medium text-luxury-800">${amenityName}</span>
        </div>
        <button type="button" onclick="removeAmenity('${amenityId}')" 
                class="w-6 h-6 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors">
            <i class="fas fa-times text-red-600 text-xs"></i>
        </button>
        <input type="hidden" name="amenities" value="${amenityId}">
    `;
    
    selectedContainer.insertBefore(amenityDiv, emptyMessage);
}

function removeAmenity(amenityId) {
    const amenityElement = document.querySelector(`[data-amenity-id="${amenityId}"]`);
    if (amenityElement) {
        amenityElement.remove();
    }
    
    // Show empty message if no amenities selected
    const selectedAmenities = document.querySelectorAll('.selected-amenity');
    const emptyMessage = document.getElementById('emptyAmenitiesMessage');
    
    if (selectedAmenities.length === 0) {
        emptyMessage.classList.remove('hidden');
    }
}
</script>

<style>
    .luxury-shadow {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .animate-fadeIn {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .luxury-25 {
        background-color: rgba(249, 250, 251, 0.5);
    }
</style>
{% endblock %}