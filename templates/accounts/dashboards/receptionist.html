{% extends 'base_luxury.html' %}
{% load static %}

{% block title %}Receptionist Dashboard - {{ user.get_full_name }}{% endblock %}

{% block page_title %}Receptionist Dashboard{% endblock %}
{% block page_subtitle %}Manage guest services and front desk operations{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Today's Check-ins</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ checkins_count }}</p>
                    <p class="text-sm text-blue-600">scheduled today</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-in-alt text-blue-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Today's Check-outs</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ checkouts_count }}</p>
                    <p class="text-sm text-green-600">scheduled today</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-out-alt text-green-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Available Rooms</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ available_rooms }}</p>
                    <p class="text-sm text-purple-600">out of {{ total_rooms }}</p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-bed text-purple-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Pending Payments</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ pending_payments_count }}</p>
                    <p class="text-sm text-yellow-600">${{ pending_payments_total|floatformat:0 }} total</p>
                </div>
                <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-credit-card text-yellow-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-luxury-600">Recent Arrivals</p>
                    <p class="text-3xl font-bold text-luxury-900">{{ recent_arrivals_count }}</p>
                    <p class="text-sm text-indigo-600">checked in today</p>
                </div>
                <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                    <i class="fas fa-users text-indigo-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-2xl p-8 luxury-shadow">
        <h2 class="text-2xl font-bold text-luxury-900 mb-6">Quick Check-in/Check-out</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-luxury-900 mb-4">Express Check-in</h3>
                <div class="space-y-4">
                    <input type="text" id="checkin-search" placeholder="Guest Name or Reservation ID" class="w-full px-4 py-3 rounded-lg border border-luxury-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <button onclick="searchAndCheckIn()" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-semibold">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Quick Check-in
                    </button>
                </div>
            </div>

            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-luxury-900 mb-4">Express Check-out</h3>
                <div class="space-y-4">
                    <input type="text" id="checkout-search" placeholder="Room Number or Guest Name" class="w-full px-4 py-3 rounded-lg border border-luxury-200 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <button onclick="searchAndCheckOut()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-semibold">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Quick Check-out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Receptionist Navigation -->
    <div class="bg-white rounded-2xl p-8 luxury-shadow">
        <h2 class="text-2xl font-bold text-luxury-900 mb-6">Front Desk Operations</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% if can_view_reservations %}
            <a href="{% url 'reservations:list' %}" class="group bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 hover:from-blue-100 hover:to-blue-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-blue-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-calendar-check text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Reservations</h3>
                    <p class="text-sm text-luxury-600">Manage bookings</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_guests %}
            <a href="{% url 'crm:list' %}" class="group bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 hover:from-green-100 hover:to-green-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-users text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Guest Management</h3>
                    <p class="text-sm text-luxury-600">Guest profiles</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_checkins %}
            <a href="{% url 'front_desk:dashboard' %}" class="group bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 hover:from-purple-100 hover:to-purple-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-purple-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-door-open text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Check-in/Check-out</h3>
                    <p class="text-sm text-luxury-600">Guest arrivals</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_rooms %}
            <a href="{% url 'hotels:room_list' user.assigned_hotel.hotel_id %}" class="group bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-6 hover:from-indigo-100 hover:to-indigo-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-indigo-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-bed text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Room Availability</h3>
                    <p class="text-sm text-luxury-600">Room status</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_payments %}
            <a href="{% url 'billing:payment_list' %}" class="group bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 hover:from-yellow-100 hover:to-yellow-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-yellow-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-credit-card text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Payments</h3>
                    <p class="text-sm text-luxury-600">Process payments</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_billing %}
            <a href="{% url 'billing:dashboard' %}" class="group bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-6 hover:from-pink-100 hover:to-pink-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-pink-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-file-invoice text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Billing</h3>
                    <p class="text-sm text-luxury-600">Create invoices</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_companies %}
            <a href="{% url 'hotels:company_list' user.assigned_hotel.hotel_id %}" class="group bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-6 hover:from-teal-100 hover:to-teal-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-teal-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-building text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Company Contracts</h3>
                    <p class="text-sm text-luxury-600">View contracts</p>
                </div>
            </a>
            {% endif %}

            {% if can_view_reports %}
            <a href="{% url 'reporting:dashboard' %}" class="group bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 hover:from-orange-100 hover:to-orange-200 transition-all duration-300 hover-lift">
                <div class="text-center">
                    <div class="w-16 h-16 bg-orange-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-chart-bar text-white text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-luxury-900 mb-2">Today's Report</h3>
                    <p class="text-sm text-luxury-600">Daily summary</p>
                </div>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Today's Schedule -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white rounded-2xl p-6 luxury-shadow">
            <h3 class="text-xl font-bold text-luxury-900 mb-4">Today's Check-ins</h3>
            {% if todays_checkins %}
                <div class="space-y-4">
                    {% for checkin in todays_checkins %}
                    <div class="flex items-center justify-between p-4 bg-luxury-50 rounded-xl">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                <span class="text-blue-600 font-semibold">{{ checkin.guest.first_name.0 }}{{ checkin.guest.last_name.0 }}</span>
                            </div>
                            <div>
                                <p class="font-medium text-luxury-900">{{ checkin.guest.full_name }}</p>
                                <p class="text-sm text-luxury-600">Room {{ checkin.room.room_number }} • {{ checkin.room.type }}</p>
                            </div>
                        </div>
                        <button onclick="quickCheckIn('{{ checkin.id }}')" class="px-3 py-1 bg-blue-500 text-white rounded-full text-sm font-medium hover:bg-blue-600 transition-colors">
                            Check-in
                        </button>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar-check text-blue-400 text-2xl"></i>
                    </div>
                    <p class="text-luxury-500 font-medium">No check-ins scheduled for today</p>
                </div>
            {% endif %}
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow">
            <h3 class="text-xl font-bold text-luxury-900 mb-4">Recent Guest Arrivals</h3>
            {% if recent_arrivals %}
                <div class="space-y-4">
                    {% for arrival in recent_arrivals %}
                    <div class="flex items-center space-x-3 p-4 bg-luxury-50 rounded-xl">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-green-600 font-semibold">{{ arrival.guest.first_name.0 }}{{ arrival.guest.last_name.0 }}</span>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-luxury-900">{{ arrival.guest.full_name }}</p>
                            <p class="text-sm text-luxury-600">Checked in • Room {{ arrival.room.room_number }}</p>
                        </div>
                        <span class="text-sm text-luxury-500">{{ arrival.stay.actual_check_in|timesince }} ago</span>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-users text-green-400 text-2xl"></i>
                    </div>
                    <p class="text-luxury-500 font-medium">No recent arrivals today</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// CSRF token for AJAX requests
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function quickCheckIn(reservationId) {
    fetch(`/reservations/${reservationId}/quick-check-in/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}

function searchAndCheckIn() {
    const searchTerm = document.getElementById('checkin-search').value.trim();
    if (!searchTerm) {
        alert('Please enter a guest name or reservation ID');
        return;
    }
    
    // Redirect to reservations list with search filter
    window.location.href = `/reservations/?search=${encodeURIComponent(searchTerm)}&status=confirmed`;
}

function searchAndCheckOut() {
    const searchTerm = document.getElementById('checkout-search').value.trim();
    if (!searchTerm) {
        alert('Please enter a room number or guest name');
        return;
    }
    
    // Redirect to reservations list with search filter
    window.location.href = `/reservations/?search=${encodeURIComponent(searchTerm)}&status=checked_in`;
}
</script>
{% endblock %}