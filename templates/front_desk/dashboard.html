{% extends 'base_luxury.html' %}
{% load static %}

{% block title %}Front Desk Operations - AuraStay{% endblock %}

{% block page_title %}Front Desk Operations{% endblock %}

{% block page_subtitle %}Manage check-ins, check-outs, and guest services{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-3xl p-6 luxury-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-in-alt text-white text-lg"></i>
                </div>
                <span class="text-3xl font-bold text-blue-600">{{ arrivals_count }}</span>
            </div>
            <h3 class="text-lg font-semibold text-luxury-800 mb-1">Today's Arrivals</h3>
            <p class="text-sm text-luxury-600">Guests checking in today</p>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-amber-500 to-amber-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-out-alt text-white text-lg"></i>
                </div>
                <span class="text-3xl font-bold text-amber-600">{{ departures_count }}</span>
            </div>
            <h3 class="text-lg font-semibold text-luxury-800 mb-1">Today's Departures</h3>
            <p class="text-sm text-luxury-600">Guests checking out today</p>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-bed text-white text-lg"></i>
                </div>
                <span class="text-3xl font-bold text-emerald-600">{{ occupied_rooms }}</span>
            </div>
            <h3 class="text-lg font-semibold text-luxury-800 mb-1">Occupied Rooms</h3>
            <p class="text-sm text-luxury-600">Currently occupied</p>
        </div>
        
        <div class="bg-white rounded-3xl p-6 luxury-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-walking text-white text-lg"></i>
                </div>
                <span class="text-3xl font-bold text-purple-600">{{ walk_ins_count }}</span>
            </div>
            <h3 class="text-lg font-semibold text-luxury-800 mb-1">Walk-ins Today</h3>
            <p class="text-sm text-luxury-600">New walk-in guests</p>
        </div>
    </div>
    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <a href="{% url 'reservations:list' %}?status=checked_in" class="bg-white rounded-3xl p-6 luxury-shadow hover-lift transition-all duration-300 group text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <i class="fas fa-sign-in-alt text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-luxury-800 mb-2">Check-in Guest</h3>
            <p class="text-sm text-luxury-600">Process guest arrivals</p>
        </a>
        
        <a href="{% url 'reservations:list' %}?status=checked_out" class="bg-white rounded-3xl p-6 luxury-shadow hover-lift transition-all duration-300 group text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-amber-500 to-amber-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <i class="fas fa-sign-out-alt text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-luxury-800 mb-2">Check-out Guest</h3>
            <p class="text-sm text-luxury-600">Process guest departures</p>
        </a>
        
        <a href="{% url 'reservations:create' %}" class="bg-white rounded-3xl p-6 luxury-shadow hover-lift transition-all duration-300 group text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <i class="fas fa-walking text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-luxury-800 mb-2">Walk-in Registration</h3>
            <p class="text-sm text-luxury-600">Register new walk-in guests</p>
        </a>
        
        <a href="{% url 'crm:list' %}" class="bg-white rounded-3xl p-6 luxury-shadow hover-lift transition-all duration-300 group text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <i class="fas fa-search text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-luxury-800 mb-2">Guest Lookup</h3>
            <p class="text-sm text-luxury-600">Find guest information</p>
        </a>
    </div>
    <!-- Guest Lists -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Today's Arrivals -->
        <div class="bg-white rounded-3xl p-8 luxury-shadow">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-in-alt text-white text-lg"></i>
                </div>
                <h3 class="text-2xl font-bold text-luxury-800">Today's Arrivals</h3>
            </div>
            
            {% if arrivals %}
                <div class="space-y-4">
                    {% for arrival in arrivals %}
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-4 border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-bold text-blue-800">{{ arrival.guest.full_name }}</h4>
                                <p class="text-sm text-blue-600">Room {{ arrival.room.room_number }} • {{ arrival.room.type }} • {{ arrival.adults }} Guest{{ arrival.adults|pluralize }}</p>
                                <p class="text-xs text-blue-500">{{ arrival.check_in|date:"M d, Y" }}</p>
                            </div>
                            <button onclick="quickCheckIn('{{ arrival.id }}')" class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white px-4 py-2 rounded-xl font-semibold hover-lift transition-all duration-300">
                                Check-in
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar-check text-blue-400 text-2xl"></i>
                    </div>
                    <p class="text-luxury-500 font-medium">No arrivals scheduled for today</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Today's Departures -->
        <div class="bg-white rounded-3xl p-8 luxury-shadow">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-12 h-12 bg-gradient-to-r from-amber-500 to-amber-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-sign-out-alt text-white text-lg"></i>
                </div>
                <h3 class="text-2xl font-bold text-luxury-800">Today's Departures</h3>
            </div>
            
            {% if departures %}
                <div class="space-y-4">
                    {% for departure in departures %}
                    <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 border border-amber-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-bold text-amber-800">{{ departure.guest.full_name }}</h4>
                                <p class="text-sm text-amber-600">Room {{ departure.room.room_number }} • {{ departure.room.type }}</p>
                                <p class="text-xs text-amber-500">{{ departure.check_out|date:"M d, Y" }}</p>
                            </div>
                            <button onclick="quickCheckOut('{{ departure.id }}')" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-xl font-semibold hover-lift transition-all duration-300">
                                Check-out
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar-times text-amber-400 text-2xl"></i>
                    </div>
                    <p class="text-luxury-500 font-medium">No departures scheduled for today</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// CSRF token for AJAX requests
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function quickCheckIn(reservationId) {
    fetch(`/reservations/${reservationId}/quick-check-in/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}

function quickCheckOut(reservationId) {
    fetch(`/reservations/${reservationId}/get-stay-id/`, {
        method: 'GET',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.stay_id) {
            window.location.href = `/billing/checkout/${data.stay_id}/`;
        } else {
            alert('Error: Unable to find stay record for checkout.');
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}
</script>

<style>
    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 32px 64px -12px rgba(0, 0, 0, 0.35);
    }
    
    .luxury-shadow {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
</style>
{% endblock %}