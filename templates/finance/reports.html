{% extends 'base_luxury.html' %}

{% block title %}Financial Reports - Finance Management{% endblock %}
{% block page_title %}Financial Reports{% endblock %}
{% block page_subtitle %}Comprehensive financial analytics and reporting dashboard{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header Section -->
    <div class="bg-white rounded-3xl p-8 luxury-shadow">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
            <div class="flex items-center space-x-4 mb-6 lg:mb-0">
                <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center luxury-shadow">
                    <i class="fas fa-chart-bar text-white text-2xl"></i>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-luxury-800">Financial Reports</h2>
                    <p class="text-luxury-600 font-medium">Comprehensive analytics and financial insights</p>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <button onclick="showModal('generateReportModal')" 
                        class="inline-flex items-center px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-2xl transition-all duration-300 hover-lift">
                    <i class="fas fa-file-alt mr-2"></i>
                    Generate Report
                </button>
                <button onclick="exportAllData()" class="inline-flex items-center px-6 py-3 bg-luxury-100 hover:bg-luxury-200 text-luxury-700 font-semibold rounded-2xl transition-all duration-300">
                    <i class="fas fa-download mr-2"></i>
                    Export Data
                </button>
            </div>
        </div>
    </div>

    <!-- Key Financial Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <i class="fas fa-arrow-up mr-1"></i>+15%
                </span>
            </div>
            <div>
                <p class="text-2xl font-bold text-luxury-800">${{ total_revenue|floatformat:0|default:"0" }}</p>
                <p class="text-sm text-luxury-600">Total Revenue</p>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-chart-line text-white text-xl"></i>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <i class="fas fa-arrow-up mr-1"></i>+8%
                </span>
            </div>
            <div>
                <p class="text-2xl font-bold text-luxury-800">${{ net_profit|floatformat:0|default:"0" }}</p>
                <p class="text-sm text-luxury-600">Net Profit</p>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-receipt text-white text-xl"></i>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <i class="fas fa-arrow-up mr-1"></i>+5%
                </span>
            </div>
            <div>
                <p class="text-2xl font-bold text-luxury-800">${{ total_expenses|floatformat:0|default:"0" }}</p>
                <p class="text-sm text-luxury-600">Total Expenses</p>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 luxury-shadow hover-lift transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-percentage text-white text-xl"></i>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    Margin
                </span>
            </div>
            <div>
                <p class="text-2xl font-bold text-luxury-800">{{ profit_margin|floatformat:1|default:"0" }}%</p>
                <p class="text-sm text-luxury-600">Profit Margin</p>
            </div>
        </div>
    </div>

    <!-- Report Categories -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Revenue Reports -->
        <div class="bg-white rounded-2xl p-6 luxury-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center mr-3">
                    <i class="fas fa-chart-line text-green-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-luxury-800">Revenue Reports</h3>
            </div>
            <div class="space-y-3">
                <button onclick="generateQuickReport('daily_revenue')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Daily Revenue</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('monthly_summary')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Monthly Summary</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('revenue_by_source')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Revenue by Source</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
            </div>
        </div>

        <!-- Expense Reports -->
        <div class="bg-white rounded-2xl p-6 luxury-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center mr-3">
                    <i class="fas fa-receipt text-red-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-luxury-800">Expense Reports</h3>
            </div>
            <div class="space-y-3">
                <button onclick="generateQuickReport('expense_categories')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Expense Categories</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('department_costs')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Department Costs</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('budget_vs_actual')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Budget vs Actual</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
            </div>
        </div>

        <!-- Payroll Reports -->
        <div class="bg-white rounded-2xl p-6 luxury-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-3">
                    <i class="fas fa-users text-blue-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-luxury-800">Payroll Reports</h3>
            </div>
            <div class="space-y-3">
                <button onclick="generateQuickReport('payroll_summary')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Payroll Summary</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('employee_costs')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Employee Costs</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
                <button onclick="generateQuickReport('tax_reports')" class="w-full flex items-center justify-between p-3 bg-luxury-50 hover:bg-luxury-100 rounded-xl transition-colors">
                    <span class="text-luxury-700">Tax Reports</span>
                    <i class="fas fa-arrow-right text-luxury-400"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Recent Reports -->
    <div class="bg-white rounded-3xl luxury-shadow overflow-hidden">
        <div class="p-6 border-b border-luxury-200">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-luxury-800">Recent Reports</h3>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-luxury-600">{{ recent_reports.count|default:"0" }} report{{ recent_reports.count|pluralize }}</span>
                </div>
            </div>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-luxury-50">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Report Name</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Type</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Period</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Generated</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Status</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-luxury-700">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-luxury-200">
                    {% for report in recent_reports %}
                    <tr class="hover:bg-luxury-50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center mr-3">
                                    <i class="fas fa-file-alt text-indigo-600"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-luxury-800">{{ report.name|default:"Monthly Financial Report" }}</div>
                                    <div class="text-sm text-luxury-600">{{ report.description|default:"Comprehensive financial overview" }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800">
                                {{ report.type|default:"Financial" }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-luxury-800">{{ report.period|default:"December 2024" }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-luxury-800">{{ report.generated_at|date:"M d, Y"|default:"Jan 2, 2025" }}</div>
                            <div class="text-sm text-luxury-600">{{ report.generated_at|time:"H:i"|default:"10:30" }}</div>
                        </td>
                        <td class="px-6 py-4">
                            {% if report.status == 'completed' %}
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200">
                                <i class="fas fa-check mr-1"></i>Completed
                            </span>
                            {% elif report.status == 'processing' %}
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 border border-yellow-200">
                                <i class="fas fa-clock mr-1"></i>Processing
                            </span>
                            {% else %}
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 border border-red-200">
                                <i class="fas fa-times mr-1"></i>Failed
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex space-x-2">
                                <button class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="View Report">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Share">
                                    <i class="fas fa-share"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="px-6 py-16 text-center">
                            <div class="flex flex-col items-center">
                                <div class="w-16 h-16 bg-luxury-100 rounded-full flex items-center justify-center mb-4">
                                    <i class="fas fa-chart-bar text-luxury-400 text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-luxury-700 mb-2">No Reports Generated</h3>
                                <p class="text-luxury-500 mb-4">Generate your first financial report</p>
                                <button onclick="showModal('generateReportModal')" 
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                                    <i class="fas fa-plus mr-2"></i>Generate Report
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Generate Report Modal -->
<div id="generateReportModal" class="fixed inset-0 z-50 hidden">
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="closeModal('generateReportModal')"></div>
    
    <div class="fixed inset-0 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl luxury-shadow max-w-2xl w-full transform transition-all">
            <div class="p-6 border-b border-luxury-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-luxury-800 flex items-center">
                        <div class="w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-file-alt text-indigo-600"></i>
                        </div>
                        Generate Financial Report
                    </h3>
                    <button onclick="closeModal('generateReportModal')" class="text-luxury-400 hover:text-luxury-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <form onsubmit="handleReportGeneration(event)" class="p-6">
                {% csrf_token %}
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-luxury-700 mb-2">Report Type</label>
                        <select name="report_type" required 
                                class="w-full px-3 py-2 border border-luxury-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Select Report Type</option>
                            <option value="revenue">Revenue Report</option>
                            <option value="expense">Expense Report</option>
                            <option value="payroll">Payroll Report</option>
                            <option value="profit_loss">Profit & Loss</option>
                            <option value="balance_sheet">Balance Sheet</option>
                            <option value="cash_flow">Cash Flow</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-luxury-700 mb-2">Start Date</label>
                            <input type="date" name="start_date" required 
                                   class="w-full px-3 py-2 border border-luxury-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-luxury-700 mb-2">End Date</label>
                            <input type="date" name="end_date" required 
                                   class="w-full px-3 py-2 border border-luxury-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-luxury-700 mb-2">Report Format</label>
                        <div class="grid grid-cols-3 gap-4">
                            <label class="flex items-center p-3 border border-luxury-300 rounded-lg cursor-pointer hover:bg-luxury-50">
                                <input type="radio" name="format" value="pdf" class="mr-2" checked>
                                <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                                <span class="text-sm font-medium">PDF</span>
                            </label>
                            <label class="flex items-center p-3 border border-luxury-300 rounded-lg cursor-pointer hover:bg-luxury-50">
                                <input type="radio" name="format" value="excel" class="mr-2">
                                <i class="fas fa-file-excel text-green-500 mr-2"></i>
                                <span class="text-sm font-medium">Excel</span>
                            </label>
                            <label class="flex items-center p-3 border border-luxury-300 rounded-lg cursor-pointer hover:bg-luxury-50">
                                <input type="radio" name="format" value="csv" class="mr-2">
                                <i class="fas fa-file-csv text-blue-500 mr-2"></i>
                                <span class="text-sm font-medium">CSV</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-luxury-700 mb-3">Include Sections</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="include_summary" checked class="rounded border-luxury-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-luxury-700">Executive Summary</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="include_charts" checked class="rounded border-luxury-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-luxury-700">Charts and Graphs</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="include_details" class="rounded border-luxury-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-luxury-700">Detailed Breakdown</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="include_comparisons" class="rounded border-luxury-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-luxury-700">Period Comparisons</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-luxury-200">
                    <button type="button" onclick="closeModal('generateReportModal')" 
                            class="px-6 py-3 bg-luxury-100 hover:bg-luxury-200 text-luxury-700 rounded-xl font-medium transition-colors">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition-colors">
                        <i class="fas fa-cog mr-2"></i>Generate Report
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function showModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

function generateQuickReport(reportType) {
    // Show loading state
    const button = event.target.closest('button');
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
    button.disabled = true;
    
    // Simulate report generation
    setTimeout(() => {
        // Reset button
        button.innerHTML = originalContent;
        button.disabled = false;
        
        // Show success message
        showNotification(`${getReportTitle(reportType)} generated successfully!`, 'success');
        
        // Simulate download
        downloadReport(reportType);
    }, 2000);
}

function getReportTitle(reportType) {
    const titles = {
        'daily_revenue': 'Daily Revenue Report',
        'monthly_summary': 'Monthly Summary Report',
        'revenue_by_source': 'Revenue by Source Report',
        'expense_categories': 'Expense Categories Report',
        'department_costs': 'Department Costs Report',
        'budget_vs_actual': 'Budget vs Actual Report',
        'payroll_summary': 'Payroll Summary Report',
        'employee_costs': 'Employee Costs Report',
        'tax_reports': 'Tax Report'
    };
    return titles[reportType] || 'Financial Report';
}

function downloadReport(reportType) {
    // Create a mock CSV content
    const csvContent = generateMockCSV(reportType);
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${reportType}_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

function generateMockCSV(reportType) {
    const today = new Date().toISOString().split('T')[0];
    
    switch(reportType) {
        case 'daily_revenue':
            return `Date,Room Revenue,F&B Revenue,Other Revenue,Total Revenue\n${today},$2500,$800,$200,$3500\n`;
        case 'monthly_summary':
            return `Month,Total Revenue,Total Expenses,Net Profit\nDecember 2024,$85000,$65000,$20000\n`;
        case 'revenue_by_source':
            return `Source,Amount,Percentage\nRoom Bookings,$65000,76.5%\nFood & Beverage,$15000,17.6%\nOther Services,$5000,5.9%\n`;
        case 'expense_categories':
            return `Category,Amount,Percentage\nStaff Salaries,$25000,38.5%\nUtilities,$8000,12.3%\nMaintenance,$5000,7.7%\nSupplies,$12000,18.5%\nOther,$15000,23.0%\n`;
        case 'department_costs':
            return `Department,Budget,Actual,Variance\nHousekeeping,$15000,$14500,$500\nFront Desk,$12000,$11800,$200\nMaintenance,$8000,$8200,-$200\n`;
        case 'budget_vs_actual':
            return `Item,Budget,Actual,Variance\nRevenue,$80000,$85000,$5000\nExpenses,$60000,$65000,-$5000\nNet Profit,$20000,$20000,$0\n`;
        case 'payroll_summary':
            return `Employee,Base Salary,Overtime,Total Pay\nJohn Doe,$3000,$200,$3200\nJane Smith,$2800,$150,$2950\nMike Johnson,$3200,$300,$3500\n`;
        case 'employee_costs':
            return `Department,Employees,Total Cost,Avg Cost\nHousekeeping,8,$24000,$3000\nFront Desk,5,$16000,$3200\nMaintenance,3,$10500,$3500\n`;
        case 'tax_reports':
            return `Tax Type,Base Amount,Rate,Tax Amount\nSales Tax,$85000,8.5%,$7225\nPayroll Tax,$54000,15.3%,$8262\nProperty Tax,$0,0%,$2500\n`;
        default:
            return `Report Type,Generated Date\n${reportType},${today}\n`;
    }
}

function handleReportGeneration(event) {
    event.preventDefault();
    
    const form = event.target;
    const formData = new FormData(form);
    const reportType = formData.get('report_type');
    const startDate = formData.get('start_date');
    const endDate = formData.get('end_date');
    const format = formData.get('format');
    
    // Validate form
    if (!reportType || !startDate || !endDate) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    if (new Date(startDate) > new Date(endDate)) {
        showNotification('Start date must be before end date', 'error');
        return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalContent = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
    submitBtn.disabled = true;
    
    // Simulate report generation
    setTimeout(() => {
        // Reset button
        submitBtn.innerHTML = originalContent;
        submitBtn.disabled = false;
        
        // Close modal
        closeModal('generateReportModal');
        
        // Generate and download report
        generateCustomReport(reportType, startDate, endDate, format);
        
        // Show success message
        showNotification(`${getReportTitle(reportType)} generated successfully!`, 'success');
        
        // Reset form
        form.reset();
    }, 2500);
}

function generateCustomReport(reportType, startDate, endDate, format) {
    let content, filename, mimeType;
    
    if (format === 'csv') {
        content = generateCustomCSV(reportType, startDate, endDate);
        filename = `${reportType}_report_${startDate}_to_${endDate}.csv`;
        mimeType = 'text/csv';
    } else if (format === 'excel') {
        content = generateCustomCSV(reportType, startDate, endDate); // Simplified as CSV for demo
        filename = `${reportType}_report_${startDate}_to_${endDate}.xlsx`;
        mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
    } else { // PDF
        content = generateCustomPDF(reportType, startDate, endDate);
        filename = `${reportType}_report_${startDate}_to_${endDate}.pdf`;
        mimeType = 'application/pdf';
    }
    
    const blob = new Blob([content], { type: mimeType });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

function generateCustomCSV(reportType, startDate, endDate) {
    const header = `${getReportTitle(reportType)}\nPeriod: ${startDate} to ${endDate}\nGenerated: ${new Date().toLocaleString()}\n\n`;
    
    switch(reportType) {
        case 'revenue':
            return header + `Date,Room Revenue,F&B Revenue,Other Revenue,Total Revenue\n${startDate},$2500,$800,$200,$3500\n${endDate},$2800,$900,$250,$3950\n`;
        case 'expense':
            return header + `Date,Category,Amount,Description\n${startDate},Utilities,$500,Monthly electricity bill\n${startDate},Supplies,$300,Cleaning supplies\n${endDate},Maintenance,$200,Room repairs\n`;
        case 'payroll':
            return header + `Employee,Department,Base Salary,Overtime,Total Pay\nJohn Doe,Housekeeping,$3000,$200,$3200\nJane Smith,Front Desk,$2800,$150,$2950\n`;
        case 'profit_loss':
            return header + `Item,Amount\nTotal Revenue,$85000\nTotal Expenses,$65000\nGross Profit,$20000\nNet Profit,$18000\n`;
        case 'balance_sheet':
            return header + `Assets,Amount\nCash,$25000\nAccounts Receivable,$15000\nInventory,$8000\nProperty & Equipment,$200000\nTotal Assets,$248000\n`;
        case 'cash_flow':
            return header + `Category,Inflow,Outflow,Net Flow\nOperating Activities,$85000,$65000,$20000\nInvesting Activities,$0,$5000,-$5000\nFinancing Activities,$10000,$8000,$2000\n`;
        default:
            return header + `Report Type,Period,Status\n${reportType},${startDate} to ${endDate},Generated\n`;
    }
}

function generateCustomPDF(reportType, startDate, endDate) {
    // Simplified PDF content as text for demo
    return `PDF Report: ${getReportTitle(reportType)}\nPeriod: ${startDate} to ${endDate}\nGenerated: ${new Date().toLocaleString()}\n\nThis is a sample PDF report content.`;
}

function exportAllData() {
    // Show loading state
    const button = event.target.closest('button');
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Exporting...';
    button.disabled = true;
    
    // Simulate export process
    setTimeout(() => {
        // Reset button
        button.innerHTML = originalContent;
        button.disabled = false;
        
        // Generate comprehensive financial export
        const csvContent = generateComprehensiveExport();
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `financial_data_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification('Financial data exported successfully!', 'success');
    }, 1500);
}

function generateComprehensiveExport() {
    const today = new Date().toISOString().split('T')[0];
    return `Financial Data Export - ${today}

REVENUE SUMMARY
Category,Amount,Percentage
Room Revenue,$65000,76.5%
Food & Beverage,$15000,17.6%
Other Services,$5000,5.9%
Total Revenue,$85000,100%

EXPENSE SUMMARY
Category,Amount,Percentage
Staff Salaries,$25000,38.5%
Utilities,$8000,12.3%
Maintenance,$5000,7.7%
Supplies,$12000,18.5%
Other,$15000,23.0%
Total Expenses,$65000,100%

PROFIT & LOSS
Item,Amount
Total Revenue,$85000
Total Expenses,$65000
Net Profit,$20000
Profit Margin,23.5%

PAYROLL SUMMARY
Department,Employees,Total Cost
Housekeeping,8,$24000
Front Desk,5,$16000
Maintenance,3,$10500
Total Payroll,16,$50500
`;
}
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl shadow-lg transform transition-all duration-300 translate-x-full`;
    
    if (type === 'success') {
        notification.className += ' bg-green-500 text-white';
        notification.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
    } else if (type === 'error') {
        notification.className += ' bg-red-500 text-white';
        notification.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
    } else {
        notification.className += ' bg-blue-500 text-white';
        notification.innerHTML = `<i class="fas fa-info-circle mr-2"></i>${message}`;
    }
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}
</script>
{% endblock %}